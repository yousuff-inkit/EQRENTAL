select jc.doc_no 'Job Card No',date_format(jc.date,'%d.%m.%Y') 'Date',jc.reftype 'Ref Type',convert(case when jc.reftype='EST' then es.voc_no when jc.reftype='GIP' then gp.voc_no else ''  end,char(25)) 'Ref No',es.voc_no 'Est No',concat(coalesce(ac.refname,''),' , Address: ', coalesce(ac.address,''),' , Telephone: ',coalesce(ac.per_tel,''),' , Mobile: ',coalesce(ac.per_mob,''),' , Mail: ', coalesce(ac.mail1,''),' , Contact Person ',coalesce(ac.contactperson,'')) 'User Details',convert(concat(coalesce(brd.brand_name,''),' ', coalesce(model.vtype,''),' Reg No: ',coalesce(gp.regno,''),' Plate Code: ',coalesce(gp.pltid,''),' YoM: ',coalesce(yom.yom,''), ' Others: ',coalesce(gp.vehother,'')),char(200)) 'Vehicle Details' from ws_jobcard jc left join ws_estm es on  (jc.refno=es.doc_no and jc.reftype='EST') left join 
(select sum(invoiceamt) invoiceamt, rdocno from ws_estlabour lab where  lab.confirmed=1 and lab.approved=1 group by rdocno ) lab on (es.doc_no=lab.rdocno) left join 
(select sum(customeramt) customeramt,estdocno from ws_jccspare group by estdocno) spare on (es.doc_no=spare.estdocno) left join ws_gateinpass gp on((jc.refno=gp.doc_no and jc.reftype='GIP') or (es.gipno=gp.doc_no and jc.reftype='EST')) left join my_acbook ac on (gp.cldocno=ac.cldocno and ac.dtype='CRM') left join gl_vehplate plate on gp.pltid=plate.doc_no left join gl_vehbrand brd on (gp.brdid=brd.doc_no) left join gl_vehmodel model on brd.doc_no=gp.modid left join gl_yom yom on gp.yom=yom.doc_no where jc.complete=1  and jc.date>='2019-04-01' and jc.date<='2019-07-28' and coalesce(spare.customeramt,0.0)=0.0 and coalesce(lab.invoiceamt,0.0)=0.0 group by jc.doc_no order by jc.doc_no


select jc.doc_no 'Job Card No',date_format(jc.date,'%d.%m.%Y') 'Date',jc.reftype 'Ref Type',convert(case when jc.reftype='EST' then es.voc_no when jc.reftype='GIP' then gp.voc_no else ''  end,char(25)) 'Ref No',es.voc_no 'Est No',concat(coalesce(ac.refname,''),' , Address: ', coalesce(ac.address,''),' , Telephone: ',coalesce(ac.per_tel,''),' , Mobile: ',coalesce(ac.per_mob,''),' , Mail: ', coalesce(ac.mail1,''),' , Contact Person ',coalesce(ac.contactperson,'')) 'User Details',convert(concat(coalesce(brd.brand_name,''),' ', coalesce(model.vtype,''),' Reg No: ',coalesce(gp.regno,''),' Plate Code: ',coalesce(gp.pltid,''),' YoM: ',coalesce(yom.yom,''), ' Others: ',coalesce(gp.vehother,'')),char(200)) 'Vehicle Details' from ws_jobcard jc left join ws_estm es on  (jc.refno=es.doc_no and jc.reftype='EST') left join (select sum(invoiceamt) invoiceamt, rdocno from ws_estlabour lab where  lab.confirmed=1 and lab.approved=1 group by rdocno ) lab on (es.doc_no=lab.rdocno) left join (select sum(customeramt) customeramt,estdocno from ws_jccspare group by estdocno) spare on (es.doc_no=spare.estdocno) left join ws_gateinpass gp on((jc.refno=gp.doc_no and jc.reftype='GIP') or (es.gipno=gp.doc_no and jc.reftype='EST')) left join my_acbook ac on (gp.cldocno=ac.cldocno and ac.dtype='CRM') left join gl_vehplate plate on gp.pltid=plate.doc_no left join gl_vehbrand brd on (gp.brdid=brd.doc_no) left join gl_vehmodel model on brd.doc_no=gp.modid left join gl_yom yom on gp.yom=yom.doc_no where jc.complete=1  and jc.date>='2019-05-01' and jc.date<='2019-07-28' and jc.doc_no=1354 and coalesce(spare.customeramt,0.0)=0.0 and coalesce(lab.invoiceamt,0.0)=0.0 group by jc.doc_no order by jc.doc_no